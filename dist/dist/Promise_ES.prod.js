"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var PENDING="PENDING",RESOLVED="RESOLVED",REJECTED="REJECTED";function resolvePromise(t,e,n,r){t===e&&r(new TypeError("# Chaining cycle detected for promise #<Promise>"));var o=!1;if("object"===_typeof(e)&&null!=e||"function"==typeof e)try{var u=e.then;"function"==typeof u?u.call(e,function(e){o||(o=!0,resolvePromise(t,e,n,r))},function(e){o||(o=!0,r(e))}):n(e)}catch(e){if(o)return;o=!0,r(e)}else n(e)}var Promise=function(){function s(e){var n=this;_classCallCheck(this,s),this.status=PENDING,this.value=this.reason=void 0,this.rejectedCallBacks=[],this.resolvedCallBacks=[];var r=function(e){n.status===PENDING&&(n.status=REJECTED,n.reason=e,n.rejectedCallBacks.forEach(function(e){return e()}))};try{e(function e(t){if(t instanceof s)return t.then(e,r);n.status===PENDING&&(n.status=RESOLVED,n.value=t,n.resolvedCallBacks.forEach(function(e){return e()}))},r)}catch(e){r(e)}}return _createClass(s,[{key:"then",value:function(r,o){var u=this;r="function"==typeof r?r:function(e){return e},o="function"==typeof o?o:function(e){throw e};var i=new s(function(t,n){u.status===RESOLVED&&setTimeout(function(){try{var e=r(u.value);resolvePromise(i,e,t,n)}catch(e){n(e)}},0),u.status===REJECTED&&setTimeout(function(){try{var e=o(u.reason);resolvePromise(i,e,t,n)}catch(e){n(e)}},0),u.status===PENDING&&(u.rejectedCallBacks.push(function(){setTimeout(function(){try{var e=o(u.reason);resolvePromise(i,e,t,n)}catch(e){n(e)}},0)}),u.resolvedCallBacks.push(function(){setTimeout(function(){try{var e=r(u.value);resolvePromise(i,e,t,n)}catch(e){n(e)}},0)}))});return i}},{key:"catch",value:function(e){return this.then(null,e)}},{key:"finally",value:function(t){return this.then(function(e){return s.resolve(t()).then(function(){return e})},function(e){return s.resolve(t()).then(function(){throw e})})}}],[{key:"resolve",value:function(n){return new s(function(e,t){e(n)})}},{key:"reject",value:function(n){return new s(function(e,t){t(n)})}}]),s}();Promise.defer=Promise.deferred=function(){var n={};return n.promise=new Promise(function(e,t){n.resolve=e,n.reject=t}),n},module.exports=Promise;